链接：https://wudaijun.com/2019/09/gs-pressure-test/

## 个人打分
⭐️⭐️⭐️⭐️⭐️

## 阅读时间
2024/10/23 - 2024/10/23

## 读书心得

我理想中的测试机器人，根本不需要那么复杂。

首先，我认为操作上，应该从 Client 客户端的角度去出发，客户端面向的是协议，比如在我的项目中，我会提供 Proto 协议，登录 -> 进入游戏大厅 -> 获取玩家信息等。
每个协议，都可以构建成组件，拖拽到画布中，用户通过连线，决定执行顺序即可！

> 上面的描述，属于基本测试，即游戏业务的算法是符合预期的

## 游戏基本测试的痛点

- 痛点一：使用测试用例，测试前需要建立 TCP 连接，这代表每次写测试用例，都很蛋疼的需要重复写
  - 建立连接
  - （可选）创建玩家
  - 进入游戏
  - 执行核心逻辑
- 痛点二：返回结果输出不好查看结果
- 痛点三：测试前，需要准备的账号太麻烦
- 痛点四：不写测试代码，根本测试不了
- 痛点五：测试流程中，没有记录每次请求的数据，无法回溯（真实客户端请求的场景中，客户端很可能缓存数据）

## 游戏基准测试思路
- 新建压测机器人，压测机器人需要满足如下条件。
  - 异步请求：异步才能模拟客户端真实场景下的请求和压力
  - 数据同步：像客户端一样缓存和处理服务器响应数据
  - 可重入：机器人应该可以在任何时候关闭/重启，而不应该假设初始状态（比如只有注册的时候能跑）
  - 随机性：机器人行为尽可能随机分布，并且每次重启重新初始化随机种子
- 确定压测对象
  - 服务器比较耗时的 API：大背包多条件排序等
  - 玩家越多越耗时的逻辑：视野同步和消息广播等
  - 玩家日常频繁操作的行为：技能面板和任务面板等
- 压测结果分析统计，从如下几个方面获取性能指标。
  - 函数级分析：Go pprof 简单易用
  - 消息级分析：统计每个 Actor 完成逻辑时，单次请求的处理时间（最大/平均/次数）
  - 服务器消息统计：统计网关层发送请求，到网关层收到响应的时间差（最大/平均/次数）。相比消息级分析，服务请求统计包含了多个 Actor 处理请求若干消息的时间，以及 Actor 之间通信的开销
  - 客户端请求统计：统计从请求发出到响应的（最大/平均/次数）时间，相比服务器消息统计，多了网络层的时延和机器人本身的处理时间，这是最接近客户端实际体验的指标
